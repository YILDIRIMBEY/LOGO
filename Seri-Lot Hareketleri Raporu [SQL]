SET DATEFIRST 1;
select
CARI.CYPHCODE	AS 'PERSONEL KODU',
CARI.DEFINITION_ AS 'MÜŞTERİ',
FATURALAR.FICHENO AS 'FATURA NO',
ITEMS.CODE AS 'KOD',
STLINE.DATE_ AS 'TARİH',
--YEAR(STLINE.DATE_) AS 'YIL',
--MONTH(STLINE.DATE_) AS 'AY',
--DATEPART(iso_week, STLINE.DATE_) AS 'HAFTA',
--CASE 
--WHEN STLINE.TRCODE IN (2,3) THEN STLINE.AMOUNT*-1
--WHEN STLINE.TRCODE IN (8,7) THEN STLINE.AMOUNT
--END AS 'MİKTAR',
'1' as 'MİKTAR',
SERI.CODE AS 'SERİ NUMARASI',
SERI.NAME AS 'SERİ AÇIKLAMA'
from LG_003_09_STLINE AS STLINE
inner join LG_003_09_STFICHE AS STFICHE on STFICHE.LOGICALREF=STLINE.STFICHEREF
inner join LG_003_ITEMS AS ITEMS  on STLINE.STOCKREF=ITEMS.LOGICALREF 
inner join LG_003_CLCARD AS CARI on CARI.LOGICALREF=STLINE.CLIENTREF
LEFT JOIN LG_003_09_INVOICE FATURALAR WITH (NOLOCK) on (STLINE.INVOICEREF = FATURALAR.LOGICALREF) 
LEFT JOIN  LG_003_09_SLTRANS AS SLTRANS WITH (NOLOCK) on (STLINE.LOGICALREF=SLTRANS.STTRANSREF)
LEFT JOIN LG_003_09_SERILOTN AS SERI WITH (NOLOCK) on (SERI.LOGICALREF=SLTRANS.SLREF)
where 
(ITEMS.CARDTYPE = 12)
and
(STLINE.TRCODE IN (2,3,7,8))
and
(STLINE.DATE_ > '01.01.2019')
AND
(SERI.CODE <> '')
--AND (STFICHE.BILLED=1)
